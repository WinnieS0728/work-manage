"use strict";var _api=require("../templates/js/_api.js");function setTable_total(){var t,a,n,r,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,a=new Date("".concat(t.getFullYear(),",12,31")),d3.select(".year-achievement .yearEnd-countdown span").text(Math.ceil((a-t)/864e5)),e.next=5,regeneratorRuntime.awrap((0,_api.getSalesAPI)());case 5:n=e.sent,r=Object.values(n).slice(1).map(function(e){return e.achievement}).reduce(function(e,t){return e+t},0),c=Object.values(n).slice(1).map(function(e){return e.goal}).reduce(function(e,t){return e+t},0),d3.select(".year-achievement .total-sales span").text(r.toLocaleString()),d3.select(".year-achievement .unachieved-sales span").text((r-c).toLocaleString()),d3.select(".year-achievement .success-rate span").text((r/c*100).toFixed(1).toLocaleString());case 11:case"end":return e.stop()}})}function setTable_sales(){var t,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){document.querySelectorAll(".budget-target .table_gap .color-number").forEach(function(e){e.__data__.achievement-e.__data__.goal<=0&&e.classList.add("bad")})},e.next=3,regeneratorRuntime.awrap((0,_api.getSalesAPI)());case 3:t=e.sent,a=Object.values(t).slice(1),d3.select(".budget-target .table_goal").selectAll(".table-data").data(a).enter().append("td").attr("class","table-data").text(function(e){return e.goal.toLocaleString()}),d3.select(".budget-target .table_achieve").selectAll(".table-data").data(a).enter().append("td").attr("class","table-data").text(function(e){return 0==e.achievement?"-":e.achievement.toLocaleString()}),d3.select(".budget-target .table_gap").selectAll(".table-data").data(a).enter().append("td").attr("class","table-data color-number").text(function(e){return 0==e.achievement?"-":(e.achievement-e.goal).toLocaleString()}),n();case 9:case"end":return e.stop()}})}function setTable_salesByPlace(){var r,t,a,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){document.querySelectorAll(".place-achievement :is(tbody,tfoot) tr td:nth-of-type(6)").forEach(function(e){e.classList.add("color-number"),e.__data__<=0&&e.classList.add("bad")}),document.querySelectorAll(".place-achievement :is(tbody,tfoot) tr td:nth-of-type(7)").forEach(function(e){e.classList.add("color-percent"),Number(e.__data__.replace("%",""))<90&&e.classList.add("bad"),100<Number(e.__data__.replace("%",""))&&e.classList.add("good")})},t=function(e,t){var a=Object.values(Object.values(r)[t]);a.push(a[1]+a[2]),a[0]?a.push(a[3]-a[0]):a.push("-");var n=a[3]/a[0]*100;a[3]&&a[0]?a.push(n.toFixed(2)+"%"):(n=0,a.push("-")),d3.select(".place-achievement .table_".concat(e)).selectAll(".table-data").data(a).enter().append("td").attr("class","table-data").text(function(e){return 0==e?"-":e.toLocaleString()})},e.next=4,regeneratorRuntime.awrap((0,_api.getSalesByPlaceAPI)());case 4:r=e.sent,t("Europe_A",0),t("USA",1),t("Europe_B",2),t("Taiwan",3),t("Other",4),t("Japan",5),t("VIP",6),t("China",7),t("TaiwanOEM",8),(a=[]).push(Object.values(r).map(function(e){return e.goal}).reduce(function(e,t){return e+t},0)),a.push(Object.values(r).map(function(e){return e.done}).reduce(function(e,t){return e+t},0)),a.push(Object.values(r).map(function(e){return e.work_on}).reduce(function(e,t){return e+t},0)),a.push(a[1]+a[2]),a.push(a[0]-a[3]),a.push((a[3]/a[0]*100).toFixed(1)+"%"),d3.select(".place-achievement .table_Total").selectAll(".table-data").data(a).enter().append("td").attr("class","table-data").text(function(e){return 0==e||"NaN%"==e?"-":e.toLocaleString()}),n();case 23:case"end":return e.stop()}})}function setTable_mission(){var n,t,a,r,c,i,l,s,o,d,u,p,f,h,m,_,b,g,y;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return y=function(e,t){e.push(r.filter(function(e){return e.principal==t}).length),e.push(c.filter(function(e){return e.principal==t}).length),e.push(i.filter(function(e){return e.principal==t}).length),e.push(n.filter(function(e){return e.principal==t}).length);var a=e[2]/e[3]*100;a||(a=0),e.push(a+"%"),e.push(s.filter(function(e){return e.principal==t}).length),e.push(o.filter(function(e){return e.principal==t}).length),d3.select(".mission-list .list-by-member .mission_to_".concat(t)).selectAll(".table-data").data(e).enter().append("td").attr("class","table-data").text(function(e){return e})},p=function(){var e=u.slice(d,d+10);d3.select(".mission-list .list-by-index tbody").selectAll("tr").data(e).join(function(e){return e.append("tr")}),e.forEach(function(e,t){var a=Object.values(e).slice(0,-1);a[6]=a[6]="",a[7]=a[7]="",d3.select(".mission-list .list-by-index tbody tr:nth-of-type(".concat(t+1,")")).selectAll("td").data(a).join(function(e){return e.append("td").attr("class","table-data").text(function(e){return e})},function(e){return e.attr("colspan","0").text(function(e){return e})})}),document.querySelectorAll(".mission-list .list-by-index tbody tr .table-data:last-child").forEach(function(e){""!==e.textContent&&(e.innerHTML='\n                    <a href="#" download="fileName">\n                        <i class="fa-solid fa-floppy-disk"></i>\n                    </a>')})},e.next=4,regeneratorRuntime.awrap((0,_api.getMissionsAPI)());case 4:n=e.sent,t=d3.timeFormat("%Y-%m-%d"),a=t(new Date),r=n.filter(function(e){return e.start_day==a}),d3.select(".mission-dashboard .new-mission p:last-child").text(r.length),c=n.filter(function(e){return 0==e.state||1==e.state}),d3.select(".mission-dashboard .mission-on-duty p:last-child").text(c.length),i=n.filter(function(e){return 2==e.state}),d3.select(".mission-dashboard .mission-complete p:last-child").text(i.length),d3.select(".mission-dashboard .total-mission p:last-child").text(n.length),l=(i.length/n.length*100).toFixed(0),d3.select(".mission-dashboard .success-rate p:last-child").text(l),s=n.filter(function(e){return"Morris"==e.mission_from}),d3.select(".mission-dashboard .mission-from-morris p:last-child").text(s.length),o=n.filter(function(e){return"Aliber"==e.mission_from}),d3.select(".mission-dashboard .mission-from-aliber p:last-child").text(o.length),d=0,u=n.reverse(),p(),f=document.querySelector("button.index_backward"),h=document.querySelector("button.index_forward"),f.addEventListener("click",function(){d<=0||(d-=10,p())}),h.addEventListener("click",function(){d+10>=n.length||(d+=10,p())}),m=[],_=[],b=[],g=[],y([],"David"),y(m,"Danise"),y(_,"Darie"),y(b,"Lorna"),y(g,"Rich");case 37:case"end":return e.stop()}})}function setTable_dailyReport(){var t,a,n,r,c,i,l;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e,t){0==e.day_point.length&&d3.select(".daily-routine .report_".concat(t," .daily-point")).append("p").text("資料未上傳"),d3.select(".daily-routine .report_".concat(t," .daily-point")).append("ol").selectAll("li").data(e.day_point).enter().append("li").text(function(e){return e}),console.log();for(var a=e.report.map(function(e){return e.title}),n=e.report.map(function(e){return 0==e.state?"(待續)":"(完成)"}),r=0;r<a.length;r++)a[r]=a[r]+n[r];0==e.report.length&&d3.select(".daily-routine .report_".concat(t," .daily-report")).append("p").text("資料未上傳"),d3.select(".daily-routine .report_".concat(t," .daily-report")).append("ol").selectAll("li").data(a).enter().append("li").text(function(e){return e})},e.next=3,regeneratorRuntime.awrap((0,_api.getDailyReportAPI)());case 3:t=e.sent,n=t.David,a(n,"David"),r=t.Danise,a(r,"Danise"),c=t.Darie,a(c,"Darie"),i=t.Lorna,a(i,"Lorna"),l=t.Rich,a(l,"Rich");case 14:case"end":return e.stop()}})}function setTable_PPTandReport(){var t,a,n,r,c,i,l,s,o,d,u,p,f;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e,t,a){d3.select(".weekly-data .weeklyData_".concat(a," .PPT .fileName")).text(e.file_name),d3.select(".weekly-data .weeklyData_".concat(a," .PPT .updateTime")).text(e.uploadTime),"``"==e.file_name&&d3.select(".weekly-data .weeklyData_".concat(a," .PPT")).html("<p>資料未上傳</p>"),d3.select(".weekly-data .weeklyData_".concat(a," .PPT a")).attr("href","".concat(e.file_path)),d3.select(".weekly-data .weeklyData_".concat(a," .PPT a")).attr("download","".concat(e.file_name)),d3.select(".weekly-data .weeklyData_".concat(a," .MeetingRecord .fileName")).text(t.file_name),d3.select(".weekly-data .weeklyData_".concat(a," .MeetingRecord .updateTime")).text(t.uploadTime),"``"==t.file_name&&d3.select(".weekly-data .weeklyData_".concat(a," .MeetingRecord")).html("<p>資料未上傳</p>"),d3.select(".weekly-data .weeklyData_".concat(a," .MeetingRecord a")).attr("href","".concat(t.file_path)),d3.select(".weekly-data .weeklyData_".concat(a," .MeetingRecord a")).attr("download","".concat(t.file_name))},e.next=3,regeneratorRuntime.awrap((0,_api.getPPTAPI)());case 3:return t=e.sent,e.next=6,regeneratorRuntime.awrap((0,_api.getMeetingRecordAPI)());case 6:a=e.sent,r=t.David,c=a.David,n(r,c,"David"),i=t.Danise,l=a.Danise,n(i,l,"Danise"),s=t.Darie,o=a.Darie,n(s,o,"Darie"),d=t.Lorna,u=a.Lorna,n(d,u,"Lorna"),p=t.Rich,f=a.Rich,n(p,f,"Rich");case 22:case"end":return e.stop()}})}setTable_total(),setTable_sales(),setTable_salesByPlace(),setTable_mission(),setTable_dailyReport(),setTable_PPTandReport();